# Capability patterns for Go
#
# Capabilities (see internal/capability/types.go for weights and risk thresholds):
#   fs:read   – reads from the filesystem
#   fs:write  – writes or deletes files
#   network   – makes outbound network connections
#   exec      – spawns subprocesses or shell commands
#   env       – reads environment variables
#   unsafe    – bypasses memory / type safety
#   crypto    – uses cryptographic primitives
#   reflect   – uses runtime reflection
#   plugin    – loads or executes external code at runtime
#
# To add a pattern: append an entry to imports or call_sites and open a PR.

name: go

# import_patterns: Go import path → capabilities granted by that package
imports:
  # ── Filesystem ────────────────────────────────────────────────────────────
  os:                       [fs:read, fs:write, env]
  io/ioutil:                [fs:read, fs:write]
  io/fs:                    [fs:read]
  bufio:                    [fs:read]
  path/filepath:            [fs:read]
  archive/tar:              [fs:read, fs:write]
  archive/zip:              [fs:read, fs:write]
  compress/gzip:            [fs:read, fs:write]
  compress/bzip2:           [fs:read]
  compress/lzw:             [fs:read, fs:write]
  compress/zlib:            [fs:read, fs:write]
  mime/multipart:           [fs:read, fs:write]

  # ── Environment / OS ──────────────────────────────────────────────────────
  os/signal:                [exec]
  log:                      [fs:write]
  log/slog:                 [fs:write]

  # ── Runtime / reflect / unsafe ────────────────────────────────────────────
  unsafe:                   [unsafe]
  reflect:                  [reflect]
  runtime:                  [reflect, unsafe]
  runtime/debug:            [reflect, unsafe]
  plugin:                   [plugin]

  # ── Network ───────────────────────────────────────────────────────────────
  net:                      [network]
  net/http:                 [network]
  net/rpc:                  [network]
  net/smtp:                 [network]
  net/mail:                 [network]
  net/url:                  [network]

  # ── Execution ─────────────────────────────────────────────────────────────
  os/exec:                  [exec]
  syscall:                  [exec, fs:read, fs:write]
  golang.org/x/sys/unix:    [exec, fs:read, fs:write]
  golang.org/x/sys/windows: [exec, fs:read, fs:write]

  # ── Crypto ────────────────────────────────────────────────────────────────
  crypto:                   [crypto]
  crypto/tls:               [crypto, network]
  crypto/rsa:               [crypto]
  crypto/aes:               [crypto]
  crypto/des:               [crypto]
  crypto/rc4:               [crypto]
  crypto/sha256:            [crypto]
  crypto/sha512:            [crypto]
  crypto/sha1:              [crypto]
  crypto/md5:               [crypto]
  crypto/hmac:              [crypto]
  crypto/ecdsa:             [crypto]
  crypto/ecdh:              [crypto]
  crypto/ed25519:           [crypto]
  crypto/rand:              [crypto]
  crypto/x509:              [crypto]
  crypto/cipher:            [crypto]
  encoding/pem:             [crypto]

  # ── Database ──────────────────────────────────────────────────────────────
  database/sql:             [network]
  database/sql/driver:      [network]

  # ── Third-party: AWS ──────────────────────────────────────────────────────
  github.com/aws/aws-sdk-go:            [network, fs:read, fs:write]
  github.com/aws/aws-sdk-go-v2:         [network, fs:read, fs:write]
  github.com/aws/aws-sdk-go-v2/service: [network]

  # ── Third-party: Google / GCP ─────────────────────────────────────────────
  google.golang.org/grpc:               [network]
  google.golang.org/api:                [network]
  cloud.google.com/go:                  [network, fs:read, fs:write]
  firebase.google.com/go:               [network]

  # ── Third-party: Networking ───────────────────────────────────────────────
  golang.org/x/net:                     [network]
  github.com/gorilla/websocket:         [network]
  github.com/gorilla/mux:               [network]
  github.com/go-resty/resty:            [network]
  github.com/hashicorp/go-retryablehttp: [network]
  github.com/valyala/fasthttp:          [network]
  github.com/gin-gonic/gin:             [network]
  github.com/labstack/echo:             [network]
  github.com/gofiber/fiber:             [network]

  # ── Third-party: Databases ────────────────────────────────────────────────
  gorm.io/gorm:                         [network]
  github.com/jinzhu/gorm:               [network]
  github.com/jackc/pgx:                 [network]
  github.com/jackc/pgconn:              [network]
  github.com/lib/pq:                    [network]
  github.com/go-sql-driver/mysql:       [network]
  github.com/mattn/go-sqlite3:          [fs:read, fs:write]
  github.com/jmoiron/sqlx:              [network]
  go.mongodb.org/mongo-driver:          [network]
  github.com/go-redis/redis:            [network]
  github.com/redis/go-redis:            [network]
  github.com/dgraph-io/badger:          [fs:read, fs:write]
  go.etcd.io/bbolt:                     [fs:read, fs:write]
  github.com/boltdb/bolt:               [fs:read, fs:write]

  # ── Third-party: Messaging / queues ──────────────────────────────────────
  github.com/Shopify/sarama:            [network]
  github.com/segmentio/kafka-go:        [network]
  github.com/nats-io/nats.go:           [network]
  github.com/rabbitmq/amqp091-go:       [network]
  github.com/streadway/amqp:            [network]
  github.com/apache/pulsar-client-go:   [network]

  # ── Third-party: Crypto / auth ────────────────────────────────────────────
  golang.org/x/crypto:                  [crypto]
  github.com/dgrijalva/jwt-go:          [crypto]
  github.com/golang-jwt/jwt:            [crypto]
  github.com/golang-jwt/jwt/v4:         [crypto]
  github.com/golang-jwt/jwt/v5:         [crypto]
  github.com/google/uuid:               [crypto]
  github.com/hashicorp/vault:           [network, crypto]
  github.com/hashicorp/vault/api:       [network, crypto]

  # ── Third-party: Plugins / dynamic exec ──────────────────────────────────
  github.com/hashicorp/go-plugin:       [plugin, exec]
  github.com/hashicorp/terraform-plugin-sdk: [plugin]

  # ── Third-party: SFTP / remote ────────────────────────────────────────────
  github.com/pkg/sftp:                  [network, fs:read, fs:write]
  golang.org/x/crypto/ssh:              [network, crypto]

  # ── Third-party: Logging ──────────────────────────────────────────────────
  github.com/sirupsen/logrus:           [fs:write]
  go.uber.org/zap:                      [fs:write]
  github.com/rs/zerolog:                [fs:write]
  github.com/apex/log:                  [fs:write]

  # ── Third-party: Observability ────────────────────────────────────────────
  github.com/prometheus/client_golang:  [network]
  go.opentelemetry.io/otel:             [network]
  go.uber.org/fx:                       [plugin, reflect]

# call_sites: package.Function call pattern → capabilities
# Key format: <pkg-base>.<FuncName>  (e.g. "exec.Command" for os/exec.Command)
call_sites:
  # ── Filesystem reads ──────────────────────────────────────────────────────
  os.Open:              [fs:read]
  os.OpenFile:          [fs:read, fs:write]
  os.ReadFile:          [fs:read]
  os.ReadDir:           [fs:read]
  os.Stat:              [fs:read]
  os.Lstat:             [fs:read]
  os.TempDir:           [fs:read]
  os.UserCacheDir:      [fs:read]
  os.UserConfigDir:     [fs:read]
  os.UserHomeDir:       [fs:read]
  ioutil.ReadFile:      [fs:read]
  ioutil.ReadDir:       [fs:read]
  ioutil.TempFile:      [fs:write]
  ioutil.TempDir:       [fs:write]
  filepath.Walk:        [fs:read]
  filepath.WalkDir:     [fs:read]
  filepath.Glob:        [fs:read]

  # ── Filesystem writes ─────────────────────────────────────────────────────
  os.WriteFile:         [fs:write]
  os.Create:            [fs:write]
  os.CreateTemp:        [fs:write]
  os.Mkdir:             [fs:write]
  os.MkdirAll:          [fs:write]
  os.MkdirTemp:         [fs:write]
  os.Remove:            [fs:write]
  os.RemoveAll:         [fs:write]
  os.Rename:            [fs:write]
  os.Symlink:           [fs:write]
  os.Link:              [fs:write]
  os.Chmod:             [fs:write]
  os.Chown:             [fs:write]
  ioutil.WriteFile:     [fs:write]

  # ── Environment ───────────────────────────────────────────────────────────
  os.Getenv:            [env]
  os.LookupEnv:         [env]
  os.Environ:           [env]
  os.Setenv:            [env]
  os.Unsetenv:          [env]
  os.Clearenv:          [env]
  os.ExpandEnv:         [env]

  # ── Exec ──────────────────────────────────────────────────────────────────
  exec.Command:         [exec]
  exec.CommandContext:  [exec]
  exec.LookPath:        [exec]
  syscall.Exec:         [exec]
  syscall.ForkExec:     [exec]
  syscall.StartProcess: [exec]

  # ── Network ───────────────────────────────────────────────────────────────
  http.Get:                  [network]
  http.Post:                 [network]
  http.PostForm:             [network]
  http.Head:                 [network]
  http.ListenAndServe:       [network]
  http.ListenAndServeTLS:    [network, crypto]
  http.NewRequest:           [network]
  http.NewRequestWithContext: [network]
  net.Dial:                  [network]
  net.DialTimeout:           [network]
  net.Listen:                [network]
  net.ResolveTCPAddr:        [network]
  net.ResolveUDPAddr:        [network]
  net.LookupHost:            [network]
  net.LookupIP:              [network]
  tls.Dial:                  [network, crypto]
  tls.Listen:                [network, crypto]

  # ── Database ──────────────────────────────────────────────────────────────
  sql.Open:             [network]
  sql.OpenDB:           [network]

  # ── Reflect / runtime ─────────────────────────────────────────────────────
  reflect.TypeOf:       [reflect]
  reflect.ValueOf:      [reflect]
  reflect.New:          [reflect]
  runtime.Gosched:      [reflect]
  runtime.GOMAXPROCS:   [reflect]
  runtime.NumGoroutine: [reflect]
  debug.Stack:          [reflect]
  debug.ReadGCStats:    [reflect]
  debug.FreeOSMemory:   [unsafe]
  debug.SetMaxStack:    [unsafe]
